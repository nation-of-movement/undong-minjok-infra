apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: app-ingress
  namespace: app
  annotations:
    nginx.ingress.kubernetes.io/use-regex: "true"
spec:
  ingressClassName: nginx
  rules:
    - http:
        paths:

          # =====================
          # 1) API (rewrite 필요)
          # =====================
          - path: /api(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: backend-svc
                port:
                  number: 8888
            pathRewrite:
              # nginx annotation:
              rewrite-target: /$2

          # ===================
          # 2) 업로드 파일
          # ===================
          - path: /uploads
            pathType: Prefix
            backend:
              service:
                name: backend-svc
                port:
                  number: 8888

          # ===================
          # 3) 정적 파일 요청 (rewrite X)
          # ===================
          - path: /assets/(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: frontend-svc
                port:
                  number: 80

          # JavaScript/CSS 파일 (rewrite 금지)
          - path: /(.*\.js|.*\.css|.*\.map|.*\.png|.*\.jpg|.*\.ico)
            pathType: ImplementationSpecific
            backend:
              service:
                name: frontend-svc
                port:
                  number: 80

          # ===================
          # 4) 모든 SPA 라우팅 → index.html
          # ===================
          - path: /(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: frontend-svc
                port:
                  number: 80
